<Page
    x:Class="Tiny_GymBook.Presentation.PlanDetail"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:Tiny_GymBook.Models"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid x:Name="RootGrid"
          RowDefinitions="Auto,*,Auto">

        <!-- Alle Übungen im aktuellen Plan -->
        <StackPanel Grid.Row="0"
                    Margin="0,0,0,8">
            <TextBlock Text="Alle Übungen im Plan:"
                       FontWeight="SemiBold"
                       FontSize="18"
                       Margin="0,0,0,4"/>
            <ListView ItemsSource="{Binding Uebungen, Mode=OneWay}">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:Uebung">
                        <TextBlock Text="{Binding Name}"
                                   FontSize="16"/>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
            <Button Content="Übung (DB) hinzufügen"
                    Command="{Binding AddUebungDBCommand}"/>
        </StackPanel>

        <!-- Gruppierte Einträge (wie gehabt) -->
        <ScrollViewer Grid.Row="1">
            <ItemsControl ItemsSource="{Binding GruppierteEintraege}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Margin="0,16,0,0">
                            <TextBlock Text="{Binding Key}"
                                       FontSize="20"
                                       FontWeight="Bold"/>
                            <ItemsControl ItemsSource="{Binding}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Uebung.Name}"
                                                   FontSize="16"
                                                   Margin="12,0,0,0"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <Button Content="Übung (nur UI) zu Tag"
                                    Command="{Binding DataContext.AddUebungToTagCommand, ElementName=RootGrid}"
                                    CommandParameter="{Binding Key}"/>
                        </StackPanel>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Footer-Buttons -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="0,8,0,8">
            <Button Content="Tag hinzufügen"
                    Command="{Binding AddTagCommand}"/>
            <Button Content="Speichern und zurück"
                    Command="{Binding SaveAndGoBackCommand}"/>
        </StackPanel>
    </Grid>
</Page>
