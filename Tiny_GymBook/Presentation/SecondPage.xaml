<Page
  x:Class="Tiny_GymBook.Presentation.SecondPage"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:models="using:Tiny_GymBook.Models"
  xmlns:utu="using:Uno.Toolkit.UI"
  mc:Ignorable="d"
  x:Name="SecondPageRoot"
  Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">


  <Grid Padding="12"
        RowSpacing="12">

    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <!-- Header -->
      <RowDefinition Height="*"/>
      <!-- List -->
      <RowDefinition Height="Auto"/>
      <!-- Footer Buttons -->
      <RowDefinition Height="Auto"/>
      <!-- TabBar -->
    </Grid.RowDefinitions>

    <!-- Titel -->
    <TextBlock Text="Trainingspläne"
               FontSize="24"
               FontWeight="Bold"
               HorizontalAlignment="Center"
               Foreground="DodgerBlue"
               Margin="0,0,0,8"/>

    <TextBlock Grid.Row="0"
               Text="{Binding Trainingsplaene.Count}"
               FontSize="18"/>

    <!-- Liste der Pläne -->
    <ListView Grid.Row="1"
              ItemsSource="{Binding Trainingsplaene}"
              SelectedItem="{Binding SelectedPlan, Mode=TwoWay}"
              IsItemClickEnabled="True"
              ItemClick="OnPlanItemClick"
              Margin="0,8">

      <ListView.ItemContainerStyle>
        <Style TargetType="ListViewItem">
          <Setter Property="HorizontalContentAlignment"
                  Value="Stretch"/>
          <Setter Property="MinHeight"
                  Value="56"/>
        </Style>
      </ListView.ItemContainerStyle>

      <ListView.ItemTemplate>
        <DataTemplate x:DataType="models:Trainingsplan">
          <Grid Padding="8"
                BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Margin="0,6"
                ColumnSpacing="12">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <!-- Name -->
              <ColumnDefinition Width="Auto"/>
              <!-- Export -->
              <ColumnDefinition Width="Auto"/>
              <!-- Delete -->
            </Grid.ColumnDefinitions>

            <!-- Name -->
            <TextBlock Text="{Binding Name}"
                       FontSize="16"
                       VerticalAlignment="Center"
                       Margin="8,0,0,0"/>

            <!-- Export (Upload icon) -->
            <Button Grid.Column="1"
                    Style="{StaticResource IconCircleButton}"
                    Command="{Binding DataContext.ExportPlanCommand, ElementName=SecondPageRoot}"
                    CommandParameter="{Binding}"
                    ToolTipService.ToolTip="Export plan"
                    AutomationProperties.Name="Export plan">
              <Button.Content>&#xE898;</Button.Content>
            </Button>

            <!-- Delete -->
            <Button Grid.Column="2"
                    Style="{StaticResource IconCircleButton}"
                    Foreground="Red"
                    Command="{Binding DataContext.DeletePlanCommand, ElementName=SecondPageRoot}"
                    CommandParameter="{Binding}"
                    ToolTipService.ToolTip="Delete plan"
                    AutomationProperties.Name="Delete plan">
              <Button.Content>&#xE74D;</Button.Content>
            </Button>
          </Grid>
        </DataTemplate>
      </ListView.ItemTemplate>
    </ListView>

    <!-- Footer: Icon-Buttons (Add + Import unterscheiden!) -->
    <StackPanel Grid.Row="2"
                Orientation="Horizontal"
                HorizontalAlignment="Center"
                Spacing="12">

      <!-- Add plan (Plus) -->
      <Button Style="{StaticResource IconCircleButton}"
              Command="{Binding AddPlanCommand}"
              ToolTipService.ToolTip="Add plan"
              AutomationProperties.Name="Add plan">
        <Button.Content>&#xE710;</Button.Content>
      </Button>

      <!-- Import from JSON (Download icon, NICHT wie Export) -->
      <Button Style="{StaticResource IconCircleButton}"
              Command="{Binding ImportFromJsonCommand}"
              ToolTipService.ToolTip="Import from JSON"
              AutomationProperties.Name="Import from JSON">
        <Button.Content>&#xE896;</Button.Content>
      </Button>
    </StackPanel>

    <!-- Bottom-Navigation -->
    <utu:TabBar Grid.Row="3"
                Margin="0,8,0,0">
      <utu:TabBar.Items>
        <utu:TabBarItem x:Uid="TabHome"
                        Padding="12"
                        Command="{Binding GoBackCommand}">
          <utu:TabBarItem.Icon>
            <FontIcon FontFamily="{ThemeResource SymbolThemeFontFamily}"
                      FontSize="24"
                      Glyph="&#xE10F;"/>
          </utu:TabBarItem.Icon>
        </utu:TabBarItem>
        <utu:TabBarItem x:Uid="TabPlans"
                        Padding="12"
                        Command="{Binding NavigateToPlaeneCommand}">
          <utu:TabBarItem.Icon>
            <FontIcon FontFamily="{ThemeResource SymbolThemeFontFamily}"
                      FontSize="24"
                      Glyph="&#xE8A5;"/>
          </utu:TabBarItem.Icon>
        </utu:TabBarItem>
      </utu:TabBar.Items>
    </utu:TabBar>

  </Grid>
</Page>
